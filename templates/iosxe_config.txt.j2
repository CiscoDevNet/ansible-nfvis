hostname {{ inventory_hostname.split('.')[0] }}
!
license smart enable
!
username {{ ansible_user }} privilege 15 secret {{ ansible_password }}
crypto key generate rsa modulus 2048
!
interface GigabitEthernet1
 vrf forwarding Mgmt-intf
 ip address ${NICID_0_IP_ADDRESS} ${NICID_0_NETMASK}
 negotiation auto
 no mop enabled
 no mop sysid
!
{% for key, value in interfaces.items() %}
interface {{ key }}
 {% if value.vlan is defined %}
 encapsulation dot1Q {{ value.vlan }}
 {% endif %}{# value.vlan is defined #}
 {% if value.description is defined %}
 description {{ interface_item.description }}
 {% endif %}
 {% if value.ip.primary.address is defined %}
 ip address {{ value.ip.primary.address }} {{ value.ip.primary.mask }}
 {% endif %}
 {% if value.enabled is sameas true %}
 no shut
{% if value.vlan is defined %}
interface {{ key | regex_replace('^([a-zA-Z0-9\/]+)\.[^a-zA-Z]+', '\\1') }}
 no shut
{%  endif %}{# enabled #}
{%  endif %}{# value.vlan is defined #}
{%  endfor %}{# interfaces #}
ip route 0.0.0.0 0.0.0.0 {{ static_routes.global[0].fwd_list[0].fwd }}
!
line vty 0 4
 login local
 transport input ssh
exit